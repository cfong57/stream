<% size = uri?.query.to_f
size = 1.0 if size <= 0.0
businesses = {
"Shoemakers" => 50.0, "Butchers" => 1200.0, "Furriers" => 250.0, "Fishmongers" => 1200.0, "Maidservants" => 250.0,
"Beer-Sellers" => 1400.0, "Tailors" => 250.0, "Buckle Makers" => 1400.0, "Barbers" => 350.0, "Plasterers" => 1400.0,
"Jewelers" => 400.0, "Spice Merchants" => 1400.0, "Taverns/Restaurants" => 400.0, "Blacksmiths" => 1500.0,
"Old-Clothes" => 400.0, "Painters" => 1500.0, "Pastrycooks" => 500.0, "Doctors (Licensed)" => 1700.0, "Masons" => 500.0, 
"Roofers" => 1800.0, "Carpenters" => 550.0, "Locksmiths" => 1900.0,"Weavers" => 600, "Bathers" => 1900.0, "Chandlers" => 700.0, 
"Ropemakers" => 1900.0, "Mercers" => 700.0, "Inns" => 2000.0, "Coopers" => 700, "Tanners" => 2000.0, "Bakers" => 800.0, 
"Copyists" => 2000.0, "Watercarriers" => 850.0, "Sculptors" => 2000.0, "Scabbardmakers" => 850.0, "Rugmakers" => 2000.0, 
"Wine-Sellers" => 900.0, "Harness-Makers" => 2000.0, "Hatmakers" => 950.0, "Bleachers" => 2100.0, "Saddlers" => 1000.0, 
"Hay Merchants" => 2300.0, "Chicken Butchers" => 1000, "Cutlers" => 2300.0, "Pursemakers" => 1100.0, "Glovemakers" => 2400.0, 
"Woodsellers" => 2400.0, "Woodcarvers" => 2400.0, "Magic-Shops" => 2800.0,"Booksellers" => 6300.0, "Bookbinders" => 3000.0, 
"Illuminators" => 3900.0, "Doctors (Total)" => 350.0
}

spoink = businesses.keys.sort

text = ""
true_total = 0
begin_round_total = 0
end_round_total = 0

text += "Business".rjust(30)
text += "Number of people".rjust(20)
text += "  \n"

spoink.each do |x|
  true_total += size / businesses[x]
  end_round_total += size / businesses[x]
  begin_round_total += (size / businesses[x]).round(2)
  text += x.rjust(30)
  text += (((size / businesses[x]).round(2)).to_s).rjust(20)
  text += "  \n"
end 
end_round_total = end_round_total.round(2)
text += "Total businesspeople (round during calc): %20s  \n" % [begin_round_total.to_s]
text += "Total businesspeople (round after calc): %20s  \n" % [end_round_total.to_s]
text += "Total businesspeople (no rounding): %20s" % [true_total.to_s]
%>

<%= markdown text %>